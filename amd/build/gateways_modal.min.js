define(["exports","core/ajax","core/templates","core/modal","core/modal_events","core/str","core/notification"],function(e,t,o,n,r,a,s){"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d=i(t),c=i(o),l=i(n),u=i(r),m=i(s);const p=e=>{const t="sandbox"===e?"https://jstest.authorize.net/v3/AcceptUI.js":"https://js.authorize.net/v3/AcceptUI.js";if(p.currentlyloaded===t)return Promise.resolve();if(p.currentlyloaded){const e=document.querySelector(`script[src="${p.currentlyloaded}"]`);e&&e.parentNode.removeChild(e)}const o=document.createElement("script");return new Promise(e=>{o.readyState?o.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,e())}:o.onload=function(){e()},o.setAttribute("src",t),o.setAttribute("charset","utf-8"),document.head.appendChild(o),p.currentlyloaded=t})};p.currentlyloaded="",e.process=(e,t,o,n)=>{let r;return((e,t,o)=>d.default.call([{methodname:"paygw_authorizedotnet_get_config_for_js",args:{component:e,paymentarea:t,itemid:o}}])[0])(e,t,o).then(async e=>{const t=await c.default.render("paygw_authorizedotnet/authorizedotnet_button",{apiloginid:e.apiloginid,clientkey:e.publicclientkey});return l.default.create({title:a.getString("pluginname","paygw_authorizedotnet"),body:t,show:!0,removeOnClose:!0}).then(t=>(r=t,p(e.environment)))}).then(()=>new Promise(n=>{window.responseHandler=function(s){if(r.getRoot().on(u.default.outsideClick,e=>{e.preventDefault()}),"Error"===s.messages.resultCode){let e="";for(let t=0;t<s.messages.message.length;t++)e+=s.messages.message[t].text+"\n";return void m.default.alert(a.getString("error","moodle"),e)}r.setBody(a.getString("authorising","paygw_authorizedotnet")),((e,t,o,n)=>d.default.call([{methodname:"paygw_authorizedotnet_process_payment",args:{component:e,paymentarea:t,itemid:o,opaquedata:JSON.stringify(n)}}])[0])(e,t,o,s.opaqueData).then(e=>(r.hide(),e)).then(n)}})).then(e=>e.success?Promise.resolve(e.message):Promise.reject(e.message))},Object.defineProperty(e,"__esModule",{value:!0})});
